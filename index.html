<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    let map;
    let driverMarkers = [];
    const DRIVERS_COUNT = 20;
    const UPDATE_INTERVAL = 5000;
    const VEHICLE_IMAGES = [
      "https://raw.githubusercontent.com/Klajdi424/image/refs/heads/main/OIP__5_-removebg-preview.png",
      "https://raw.githubusercontent.com/Klajdi424/image/refs/heads/main/OIP__6_-removebg-preview.png",
      "https://raw.githubusercontent.com/Klajdi424/image/refs/heads/main/OIP__7_-removebg-preview.png",
      "https://raw.githubusercontent.com/Klajdi424/image/refs/heads/main/driver.png"
    ];

    function initMap() {
      const params = new URLSearchParams(window.location.search);
      const userLoc = {
        lat: parseFloat(params.get("userLat")) || 41.1533,
        lng: parseFloat(params.get("userLng")) || 20.1683
      };

      map = L.map('map').setView(userLoc, 13);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      new L.marker(userLoc, {
        icon: L.icon({
          iconUrl: "https://raw.githubusercontent.com/Klajdi424/image/refs/heads/main/Your_paragraph_text__4_-removebg-preview.png",
          iconSize: [50, 50]
        })
      }).addTo(map);

      for (let i = 0; i < DRIVERS_COUNT; i++) {
        const start = randomPoint(userLoc, 0.05);
        createDriver(start, i % VEHICLE_IMAGES.length);
      }
    }

    function randomPoint(center, range) {
      return {
        lat: center.lat + (Math.random() * 2 - 1) * range,
        lng: center.lng + (Math.random() * 2 - 1) * range
      };
    }

    function createDriver(position, vehicleImageIndex) {
      const marker = L.marker(position, {
        icon: L.icon({
          iconUrl: VEHICLE_IMAGES[vehicleImageIndex],
          iconSize: [50, 50]
        })
      }).addTo(map);
      driverMarkers.push({ marker, position, direction: randomPoint(position, 0.02) });
    }

    function animateDrivers() {
      driverMarkers.forEach(driver => {
        const { marker, position, direction } = driver;
        const latDelta = (direction.lat - position.lat) / 50;
        const lngDelta = (direction.lng - position.lng) / 50;
        let step = 0;

        const interval = setInterval(() => {
          step++;
          position.lat += latDelta;
          position.lng += lngDelta;
          marker.setLatLng(position);

          if (step >= 50) {
            clearInterval(interval);
            driver.direction = randomPoint(position, 0.02);
          }
        }, UPDATE_INTERVAL / 50);
      });
    }

    setInterval(animateDrivers, UPDATE_INTERVAL);
  </script>
  <style>
    html, body { margin: 0; padding: 0; height: 100%; }
    #map { height: 100%; width: 100%; }
  </style>
</head>
<body onload="initMap()">
  <div id="map"></div>
</body>
</html>
