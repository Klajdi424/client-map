<!DOCTYPE html>
<html>
<head>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDESOPDnAmfX5e5qqWc0Smy6kpj3kfN_J0" async defer></script>
  <script>
    let map, userMarker;
    const driverRoutes = [];
    const SPEED_MPH = 10; 
    const SPEED_KM_S = 16.0934 / 3600; 

    function initMap() {
      const params = new URLSearchParams(window.location.search);
      const userLoc = {
        lat: parseFloat(params.get("userLat")) || 51.5074,
        lng: parseFloat(params.get("userLng")) || -0.1278
      };

      map = new google.maps.Map(document.getElementById("map"), {
        center: userLoc,
        zoom: 13,
        disableDefaultUI: true
      });

      userMarker = new google.maps.Marker({
        position: userLoc,
        map: map,
        icon: {
          url: "https://raw.githubusercontent.com/Klajdi424/image/refs/heads/main/images%20(9).jpg",
          scaledSize: new google.maps.Size(50, 50)
        }
      });

      const driverIcons = [
        "https://raw.githubusercontent.com/Klajdi424/image/refs/heads/main/OIP__5_-removebg-preview.png",
        "https://raw.githubusercontent.com/Klajdi424/image/refs/heads/main/OIP__6_-removebg-preview.png",
        "https://raw.githubusercontent.com/Klajdi424/image/refs/heads/main/OIP__7_-removebg-preview.png",
        "https://raw.githubusercontent.com/Klajdi424/image/refs/heads/main/driver.png"
      ];

      for (let i = 0; i < 20; i++) {
        const radius = Math.random() * (0.02 - 0.005) + 0.005; 
        const angle = Math.random() * 2 * Math.PI;
        const icon = driverIcons[i % driverIcons.length];
        const pos = {
          lat: userLoc.lat + radius * Math.cos(angle),
          lng: userLoc.lng + radius * Math.sin(angle)
        };
        const marker = new google.maps.Marker({
          position: pos,
          map: map,
          icon: { url: icon, scaledSize: new google.maps.Size(50, 50) }
        });
        const angularSpeed = SPEED_KM_S / (radius * 111); 
        driverRoutes.push({ marker, center: userLoc, radius, angle, angularSpeed });
      }

      const bounds = new google.maps.LatLngBounds();
      bounds.extend(userLoc);
      driverRoutes.forEach(dr => {
        const pos = {
          lat: dr.center.lat + dr.radius * Math.cos(dr.angle),
          lng: dr.center.lng + dr.radius * Math.sin(dr.angle)
        };
        bounds.extend(pos);
      });
      map.fitBounds(bounds);

      setInterval(updateDriverPositions, 1000);
    }

    function updateDriverPositions() {
      driverRoutes.forEach(route => {
        route.angle += route.angularSpeed;
        const newPos = {
          lat: route.center.lat + route.radius * Math.cos(route.angle),
          lng: route.center.lng + route.radius * Math.sin(route.angle)
        };
        route.marker.setPosition(new google.maps.LatLng(newPos.lat, newPos.lng));
      });
    }
  </script>
  <style>
    html, body { margin: 0; padding: 0; height: 100%; }
    #map { height: 100%; width: 100%; }
  </style>
</head>
<body onload="initMap()">
  <div id="map"></div>
</body>
</html>
