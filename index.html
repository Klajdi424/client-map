<!DOCTYPE html>
<html>
<head>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDESOPDnAmfX5e5qqWc0Smy6kpj3kfN_J0" async defer></script>
  <script>
    let map, userMarker, driverMarkers = [];

    function initMap() {
      const defaultUserLoc = { lat: 51.5074, lng: -0.1278 };
      map = new google.maps.Map(document.getElementById("map"), {
        center: defaultUserLoc,
        zoom: 13,
        disableDefaultUI: true
      });

      userMarker = new google.maps.Marker({
        position: defaultUserLoc,
        map: map,
        icon: { url: "https://raw.githubusercontent.com/Klajdi424/image/refs/heads/main/OIP__5_-removebg-preview.png", scaledSize: new google.maps.Size(50, 50) }
      });

      addDrivers(defaultUserLoc);
      
      const bounds = new google.maps.LatLngBounds();
      bounds.extend(defaultUserLoc);
      driverMarkers.forEach(marker => bounds.extend(marker.getPosition()));
      map.fitBounds(bounds);
      
      setInterval(simulateDriverMovement, 2000);
    }

    function addDrivers(userLoc) {
      const categories = [
        { icon: "https://raw.githubusercontent.com/Klajdi424/image/refs/heads/main/OIP__5_-removebg-preview.png", count: 5 },
        { icon: "https://raw.githubusercontent.com/Klajdi424/image/refs/heads/main/OIP__6_-removebg-preview.png", count: 5 },
        { icon: "https://raw.githubusercontent.com/Klajdi424/image/refs/heads/main/OIP__7_-removebg-preview.png", count: 5 },
        { icon: "https://raw.githubusercontent.com/Klajdi424/image/refs/heads/main/driver.png", count: 5 }
      ];
      
      categories.forEach(cat => {
        for (let i = 0; i < cat.count; i++) {
          const offsetLat = (Math.random() - 0.5) * 0.02;
          const offsetLng = (Math.random() - 0.5) * 0.02;
          const driverLoc = { lat: userLoc.lat + offsetLat, lng: userLoc.lng + offsetLng };
          const marker = new google.maps.Marker({
            position: driverLoc,
            map: map,
            icon: { url: cat.icon, scaledSize: new google.maps.Size(50, 50) }
          });
          driverMarkers.push({ marker, lat: driverLoc.lat, lng: driverLoc.lng });
        }
      });
    }

    function simulateDriverMovement() {
      driverMarkers.forEach(driver => {
        const deltaLat = (Math.random() - 0.5) * 0.001;
        const deltaLng = (Math.random() - 0.5) * 0.001;
        const newLat = driver.lat + deltaLat;
        const newLng = driver.lng + deltaLng;

        smoothMoveMarker(driver.marker, { lat: newLat, lng: newLng });

        driver.lat = newLat;
        driver.lng = newLng;
      });
    }

    function smoothMoveMarker(marker, newPosition) {
      const oldPosition = marker.getPosition();
      const frames = 30;
      let count = 0;
      
      const deltaLat = (newPosition.lat - oldPosition.lat()) / frames;
      const deltaLng = (newPosition.lng - oldPosition.lng()) / frames;
      
      const interval = setInterval(() => {
        count++;
        const nextLat = oldPosition.lat() + deltaLat * count;
        const nextLng = oldPosition.lng() + deltaLng * count;
        
        marker.setPosition(new google.maps.LatLng(nextLat, nextLng));
        
        if (count >= frames) {
          clearInterval(interval);
        }
      }, 50);
    }
  </script>
  <style>
    html, body { margin: 0; padding: 0; height: 100%; }
    #map { height: 100%; width: 100%; }
  </style>
</head>
<body onload="initMap()">
  <div id="map"></div>
</body>
</html>
