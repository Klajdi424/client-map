<!DOCTYPE html>
<html>
<head>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://router.project-osrm.org/route/v1/driving/"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script>
    let map;
    const driverMarkers = [];
    const driverRoutes = [];
    const DRIVERS_COUNT = 10;
    const UPDATE_INTERVAL = 5000;
    const VEHICLE_IMAGES = [
      "https://raw.githubusercontent.com/Klajdi424/image/refs/heads/main/OIP__5_-removebg-preview.png",
      "https://raw.githubusercontent.com/Klajdi424/image/refs/heads/main/OIP__6_-removebg-preview.png",
      "https://raw.githubusercontent.com/Klajdi424/image/refs/heads/main/OIP__7_-removebg-preview.png",
      "https://raw.githubusercontent.com/Klajdi424/image/refs/heads/main/driver.png"
    ];

    function initMap() {
      const params = new URLSearchParams(window.location.search);
      const userLat = parseFloat(params.get("userLat")) || 41.3275;
      const userLng = parseFloat(params.get("userLng")) || 19.8189;

      map = L.map('map').setView([userLat, userLng], 13);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      L.marker([userLat, userLng], {
        icon: L.icon({
          iconUrl: "https://raw.githubusercontent.com/Klajdi424/image/refs/heads/main/Your_paragraph_text__4_-removebg-preview.png",
          iconSize: [50, 50]
        })
      }).addTo(map);

      for (let i = 0; i < DRIVERS_COUNT; i++) {
        const start = randomNearbyPoint(userLat, userLng, 0.01);
        const end = randomNearbyPoint(userLat, userLng, 0.05);
        createDriverRoute(start, end, i % VEHICLE_IMAGES.length);
      }
    }

    function randomNearbyPoint(lat, lng, range) {
      return [lat + (Math.random() * 2 - 1) * range, lng + (Math.random() * 2 - 1) * range];
    }

    function createDriverRoute(start, end, vehicleImageIndex) {
      fetch(`https://router.project-osrm.org/route/v1/driving/${start[1]},${start[0]};${end[1]},${end[0]}?overview=full&geometries=geojson`)
        .then(response => response.json())
        .then(data => {
          if (data.routes.length > 0) {
            const route = data.routes[0].geometry.coordinates.map(coord => [coord[1], coord[0]]);
            const polyline = L.polyline(route, { color: '#8A2BE2', weight: 4 }).addTo(map);
            const marker = L.marker(route[0], {
              icon: L.icon({
                iconUrl: VEHICLE_IMAGES[vehicleImageIndex],
                iconSize: [40, 40]
              })
            }).addTo(map);
            driverMarkers.push({ marker, route, index: 0 });
          }
        });
    }

    function moveDrivers() {
      driverMarkers.forEach(driver => {
        if (driver.index < driver.route.length - 1) {
          driver.index++;
          driver.marker.setLatLng(driver.route[driver.index]);
        } else {
          driver.index = 0;
        }
      });
    }

    setInterval(moveDrivers, UPDATE_INTERVAL);
  </script>
  <style>
    html, body { margin: 0; padding: 0; height: 100%; }
    #map { height: 100%; width: 100%; }
  </style>
</head>
<body onload="initMap()">
  <div id="map"></div>
</body>
</html>
